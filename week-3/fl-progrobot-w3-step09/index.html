<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Improving the line following - Robotics</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Improving the line following";
    var mkdocs_page_input_path = "week-3\\fl-progrobot-w3-step09.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Robotics</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">fl-programming-robotics</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Building a mobile robot</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step01/">Welcome to the course</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step02/">Meet the team and your fellow learners</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step03/">The world of robotics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step04/">Raspberry Pi and General-Purpose Input/Output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step05/">Connecting a motor to the motor controller</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step06/">Connecting the Raspberry Pi and battery pack to the motorboard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step07/">Testing the motors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step08/">Designing the chassis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step09/">Attaching the components to the chassis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step10/">Making the robot move</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step11/">Challenge: Driving in patterns</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step12/">Why we call robotics challenging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step13/">The end of week one</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Automating actions using distance sensors</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step01/">Welcome to week two</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step02/">Quiz: Mobile robotics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step03/">How could you improve the functionality of the buggy?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step04/">Robotic sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step05/">Autonomous robots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step06/">Ultrasonic distance sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step07/">Attaching the UDS to the buggy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step08/">Programming the UDS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step09/">Avoiding obstacles autonomously</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step10/">Challenge: Improving the obstacle-avoidance program</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step11/">Quiz: How do distance sensors work?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-2/fl-progrobot-w2-step12/">The end of week two</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Allowing Robots to follow lines</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step01/">Welcome to week three</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step03/">Line-sensing robots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step04/">Line sensors and how to use them</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step05/">Connecting the line sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step06/">Testing the line sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step07/">Sharing your progress</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step08/">Program a line-following algorithm</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Improving the line following</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#setting-up-the-program">Setting up the program</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#planning-a-better-program">Planning a better program</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#three-rules-to-rule-them-all">Three rules to rule them all</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#programming-the-rules">Programming the rules</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#test-your-program">Test your program</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step10/">Robotics is changing our lives</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step11/">Peer-assessment: Create a new function for your robot buggy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step12/">Reviewing your peer's work</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w3-step14/">The end of the course</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Robotics</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Allowing Robots to follow lines &raquo;</li>
        
      
    
    <li>Improving the line following</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>[comment]: # (
Is this step open? Y/N
If so, short description of this step:
Related links:
Related files:
)</p>
<h2 id="improving-the-line-following">Improving the line following</h2>
<p>The previous line-following program is OK, but the robot can move from side to side quite a lot as it follows the line. To make the movement more elegant, you can slow down the speed of the robot, making the turns smaller and more gradual.</p>
<p>However, the <code>when_line</code> and <code>when_no_line</code> events don't allow you to modify the robot's default speed. To have more control over the robot, you can adapt your program so that it considers the states of the line sensors and uses these to choose the actions that are required of the motors.</p>
<h3 id="setting-up-the-program">Setting up the program</h3>
<p><strong>1.</strong> Copy the code from the last step into a new Python file.</p>
<p><strong>2.</strong> Remove all of the code <strong>after</strong> you have initialised the variables <code>left_sensor</code> and <code>right_sensor</code>.</p>
<p><strong>3.</strong> After those variables have been defined, initialise the variables for controlling the speed of the motors and the timer:</p>
<pre><code class="python">speed = 0.75

duration = 10
end_time = time() + duration

running = True
</code></pre>

<p>The value for each motor will be modified by the <code>speed</code> multiplier to slow down the robot a little. The value for <code>speed</code> usually needs to be at least 0.6, otherwise the motors do not have enough momentum to turn on a solid surface; the maximum value is 1.</p>
<p>The other variables are used to create a timer so that the robot doesn't run forever, as with the UDS program last week. Remember that <code>duration</code> is the number of seconds your program will run for, and you can modify this yourself.</p>
<h3 id="planning-a-better-program">Planning a better program</h3>
<p>To have more control over the robot's movement and speed, your program needs to choose how to instruct the motors based on the values received from the line sensors.</p>
<p>Remember that when a line sensor is above a line, it outputs a <code>1</code>. When it’s off a line, it outputs a <code>0</code>. You can’t simply pass these values straight to the motors, because the motors accept a range of values from <code>-1</code> to <code>1</code>; positive values tell the motor to run forwards and negative values tell it to run in reverse.</p>
<p>Taking this behaviour into account, I am going to define three rules to determine what outputs are sent to the motors.</p>
<h3 id="three-rules-to-rule-them-all">Three rules to rule them all</h3>
<p><strong>Rule 1</strong></p>
<p>If both line sensors output <code>0</code>, both motors should receive a positive value to drive forwards.</p>
<p><strong>Rule 2</strong></p>
<p>If the left sensor outputs <code>1</code>, the robot has drifted to the right and needs to turn left. In this case, the left motor should run backwards (a negative signal is needed), while the right motor should run forwards.</p>
<p><strong>Rule 3</strong></p>
<p>If the right sensor outputs <code>1</code>, the robot has drifted to the left and needs to turn right. Therefore, the right motor should run backwards (a negative signal is needed), while the left motor should run forwards.</p>
<p><img alt="A table showing the robot directions based on the left line sensor and right line sensor readings." src="https://rpf-futurelearn.s3-eu-west-1.amazonaws.com/Robotics+-+Robot+Buggy/Illustration/37-3_9-table-sensor-values.png" /></p>
<p>Why do you think there is not a rule for both the sensors outputting a <code>1</code> simultaneously?</p>
<h3 id="programming-the-rules">Programming the rules</h3>
<p>To start applying these rules, the code needs to read the outputs of the line sensors repeatedly, in a loop.</p>
<p><strong>4.</strong> Add a <code>while</code> loop to the program, after where you initialised the speed and timer variables.</p>
<pre><code class="python">while running:
    left_detect  = left_sensor.value
    right_detect = right_sensor.value

    print (left_detect, right_detect)
</code></pre>

<p><strong>5.</strong> If you run the program now, you should see the binary output from the sensors change when you move the sensors over and off the line, in accordance with the rules stated above.</p>
<p><strong>6.</strong> Inside the <code>while</code> loop, use conditional statements to specify the direction of each motor, depending on the line sensor readings:</p>
<pre><code class="python">while running:
    left_detect  = left_sensor.value
    right_detect = right_sensor.value

    # Rule 1
    if left_detect == 0 and right_detect == 0:
        left_mot = 1
        right_mot = 1
    # Rule 2
    elif left_detect == 1:
        left_mot = -1
        right_mot = 1
    # Rule 3
    elif right_detect == 1:
        left_mot = 1
        right_mot = -1

    print (left_mot, right_mot)    
</code></pre>

<p><strong>7.</strong> Run your code and test that the program outputs the correct motor values when you move the robot over and off the line.</p>
<p><strong>8.</strong> Inside the loop, remove the <code>print</code> statement and replace it with:</p>
<pre><code class="python">    robin.left_motor.value = left_mot * speed
    robin.right_motor.value = right_mot * speed
</code></pre>

<p>The value for each motor will be modified by the <code>speed</code> multiplier, to slow the robot down a little.</p>
<p>Make sure you remove any <code>print</code> statements within the loop, otherwise these will affect the response time of the program and the robot may overshoot the line.</p>
<p><strong>9.</strong> To stop the <code>while</code> loop from running forever, and to close all the component's connections cleanly, add this code inside the loop, at the end:</p>
<pre><code class="python">    if time() &gt;= end_time:
        running = False
        robin.stop()
        robin.close()
        left_sensor.close()
        right_sensor.close()
</code></pre>

<h3 id="test-your-program">Test your program</h3>
<p>Now run your code and test your robot over a track.</p>
<p>Try different values for <code>speed</code> (between 0 and 1) and check how your robot runs.</p>
<p>How does this affect your robot's ability to follow the line?</p>
<p>Share your findings in the comments section.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../fl-progrobot-w3-step10/" class="btn btn-neutral float-right" title="Robotics is changing our lives">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../fl-progrobot-w3-step08/" class="btn btn-neutral" title="Program a line-following algorithm"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../fl-progrobot-w3-step08/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../fl-progrobot-w3-step10/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
