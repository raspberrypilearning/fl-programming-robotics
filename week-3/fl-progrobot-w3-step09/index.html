<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Fl progrobot w3 step09 - Robotics</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Robotics</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Building a mobile robot <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step01/" class="dropdown-item">1</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step02.md" class="dropdown-item">2</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step03/" class="dropdown-item">3</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step04/" class="dropdown-item">4</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step05/" class="dropdown-item">5</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step06/" class="dropdown-item">6</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step07/" class="dropdown-item">7</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step08/" class="dropdown-item">8</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step09/" class="dropdown-item">9</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step10/" class="dropdown-item">10</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step11/" class="dropdown-item">11</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step12/" class="dropdown-item">12</a>
</li>
                                    
<li>
    <a href="../../week-1/fl-progrobot-w1-step13/" class="dropdown-item">13</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#improving-the-line-following" class="nav-link">Improving the line following</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>[comment]: # (
Is this step open? Y/N
If so, short description of this step:
Related links:
Related files:
)</p>
<h2 id="improving-the-line-following">Improving the line following</h2>
<p>The previous line-following program is OK, but the robot can move from side to side quite a lot as it follows the line. To make the movement more elegant, you can slow down the speed of the robot, making the turns smaller and more gradual.</p>
<p>However, the <code>when_line</code> and <code>when_no_line</code> events don't allow you to modify the robot's default speed. To have more control over the robot, you can adapt your program so that it considers the states of the line sensors and uses these to choose the actions that are required of the motors.</p>
<h3 id="setting-up-the-program">Setting up the program</h3>
<p><strong>1.</strong> Copy the code from the last step into a new Python file.</p>
<p><strong>2.</strong> Remove all of the code <strong>after</strong> you have initialised the variables <code>left_sensor</code> and <code>right_sensor</code>.</p>
<p><strong>3.</strong> After those variables have been defined, initialise the variables for controlling the speed of the motors and the timer:</p>
<pre><code class="python">speed = 0.75

duration = 10
end_time = time() + duration

running = True
</code></pre>

<p>The value for each motor will be modified by the <code>speed</code> multiplier to slow down the robot a little. The value for <code>speed</code> usually needs to be at least 0.6, otherwise the motors do not have enough momentum to turn on a solid surface; the maximum value is 1.</p>
<p>The other variables are used to create a timer so that the robot doesn't run forever, as with the UDS program last week. Remember that <code>duration</code> is the number of seconds your program will run for, and you can modify this yourself.</p>
<h3 id="planning-a-better-program">Planning a better program</h3>
<p>To have more control over the robot's movement and speed, your program needs to choose how to instruct the motors based on the values received from the line sensors.</p>
<p>Remember that when a line sensor is above a line, it outputs a <code>1</code>. When it’s off a line, it outputs a <code>0</code>. You can’t simply pass these values straight to the motors, because the motors accept a range of values from <code>-1</code> to <code>1</code>; positive values tell the motor to run forwards and negative values tell it to run in reverse.</p>
<p>Taking this behaviour into account, I am going to define three rules to determine what outputs are sent to the motors.</p>
<h3 id="three-rules-to-rule-them-all">Three rules to rule them all</h3>
<p><strong>Rule 1</strong></p>
<p>If both line sensors output <code>0</code>, both motors should receive a positive value to drive forwards.</p>
<p><strong>Rule 2</strong></p>
<p>If the left sensor outputs <code>1</code>, the robot has drifted to the right and needs to turn left. In this case, the left motor should run backwards (a negative signal is needed), while the right motor should run forwards.</p>
<p><strong>Rule 3</strong></p>
<p>If the right sensor outputs <code>1</code>, the robot has drifted to the left and needs to turn right. Therefore, the right motor should run backwards (a negative signal is needed), while the left motor should run forwards.</p>
<p><img alt="A table showing the robot directions based on the left line sensor and right line sensor readings." src="https://rpf-futurelearn.s3-eu-west-1.amazonaws.com/Robotics+-+Robot+Buggy/Illustration/37-3_9-table-sensor-values.png" /></p>
<p>Why do you think there is not a rule for both the sensors outputting a <code>1</code> simultaneously?</p>
<h3 id="programming-the-rules">Programming the rules</h3>
<p>To start applying these rules, the code needs to read the outputs of the line sensors repeatedly, in a loop.</p>
<p><strong>4.</strong> Add a <code>while</code> loop to the program, after where you initialised the speed and timer variables.</p>
<pre><code class="python">while running:
    left_detect  = left_sensor.value
    right_detect = right_sensor.value

    print (left_detect, right_detect)
</code></pre>

<p><strong>5.</strong> If you run the program now, you should see the binary output from the sensors change when you move the sensors over and off the line, in accordance with the rules stated above.</p>
<p><strong>6.</strong> Inside the <code>while</code> loop, use conditional statements to specify the direction of each motor, depending on the line sensor readings:</p>
<pre><code class="python">while running:
    left_detect  = left_sensor.value
    right_detect = right_sensor.value

    # Rule 1
    if left_detect == 0 and right_detect == 0:
        left_mot = 1
        right_mot = 1
    # Rule 2
    elif left_detect == 1:
        left_mot = -1
        right_mot = 1
    # Rule 3
    elif right_detect == 1:
        left_mot = 1
        right_mot = -1

    print (left_mot, right_mot)    
</code></pre>

<p><strong>7.</strong> Run your code and test that the program outputs the correct motor values when you move the robot over and off the line.</p>
<p><strong>8.</strong> Inside the loop, remove the <code>print</code> statement and replace it with:</p>
<pre><code class="python">    robin.left_motor.value = left_mot * speed
    robin.right_motor.value = right_mot * speed
</code></pre>

<p>The value for each motor will be modified by the <code>speed</code> multiplier, to slow the robot down a little.</p>
<p>Make sure you remove any <code>print</code> statements within the loop, otherwise these will affect the response time of the program and the robot may overshoot the line.</p>
<p><strong>9.</strong> To stop the <code>while</code> loop from running forever, and to close all the component's connections cleanly, add this code inside the loop, at the end:</p>
<pre><code class="python">    if time() &gt;= end_time:
        running = False
        robin.stop()
        robin.close()
        left_sensor.close()
        right_sensor.close()
</code></pre>

<h3 id="test-your-program">Test your program</h3>
<p>Now run your code and test your robot over a track.</p>
<p>Try different values for <code>speed</code> (between 0 and 1) and check how your robot runs.</p>
<p>How does this affect your robot's ability to follow the line?</p>
<p>Share your findings in the comments section.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
