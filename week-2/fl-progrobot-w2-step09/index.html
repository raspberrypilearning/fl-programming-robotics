<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Fl progrobot w2 step09 - Robotics</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Fl progrobot w2 step09";
    var mkdocs_page_input_path = "week-2\\fl-progrobot-w2-step09.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Robotics</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Building a mobile robot</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step01/">Welcome to the course</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step02/">Meet the team and your fellow learners</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step03/">The world of robotics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step04/">4</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step05/">5</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step06/">6</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step07/">7</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step08/">8</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step09/">9</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step10/">10</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step11/">11</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step12/">12</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step13/">13</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Robotics</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Fl progrobot w2 step09</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>[comment]: # (
Is this step open? Y/N
If so, short description of this step:
Related links:
Related files:
)</p>
<h2 id="avoiding-obstacles-autonomously">Avoiding obstacles autonomously</h2>
<p>So far, you have created programs for moving the robot buggy and detecting objects at different distances. Now you are going to create a program for detecting and navigating around objects autonomously.</p>
<h3 id="programming-the-motors-and-the-uds">Programming the motors and the UDS</h3>
<p>For this program, you will need to bring together some of the code you have written during the course to solve a new problem.</p>
<p>To help you begin this process, consider the different parts of the problem:</p>
<ul>
<li>What components does your program need to interact with?</li>
<li>What should the robot do if an object is <em>not</em> too close to it?</li>
<li>How should the robot behave when an object <em>is</em> too close?</li>
</ul>
<h4 id="setting-up-the-program">Setting up the program</h4>
<p><strong>1.</strong> Copy the code from the last step into a new Python file.</p>
<p><strong>2.</strong> Change the first line of code so that <code>Robot</code> is also imported from the <code>gpiozero</code> library to control the motors.</p>
<pre><code class="python">from gpiozero import Robot, InputDevice, OutputDevice
</code></pre>

<p><strong>3.</strong> After the <code>trig</code> and <code>echo</code> variables have been initialised, define the <code>Robot</code> using the GPIO pins for your <code>left</code> and <code>right</code> motors.</p>
<pre><code class="python">robin = Robot(left=(8,7), right=(9,10))
</code></pre>

<p>You can use one of your working programs from week one to check that the GPIO pins of your motors are set correctly, as they may be different to the ones I've used above.</p>
<h4 id="setting-up-a-timer">Setting up a timer</h4>
<p>Next, you are going to create a timer so that your robot doesn't run forever, which is especially useful during the testing phases.</p>
<p><strong>4.</strong> Add in these three variables just after you have initialised <code>Robot</code>:</p>
<pre><code class="python">duration = 10
end_time = time() + duration
running = True
</code></pre>

<p>The value of <code>duration</code> is the number of seconds that the timer will run for. Calculate <code>end_time</code> by adding <code>duration</code> to the current time, which is obtained using the <code>time()</code> function.</p>
<p>You will use the <code>running</code> variable later to specify when the program (and the robot) should stop running.</p>
<p>Check your program so far against my <a href="https://rpf-futurelearn.s3-eu-west-1.amazonaws.com/Robotics+-+Robot+Buggy/code/uds-motors-halfway.py">version of the program after step 4</a>.</p>
<p>The last changes you are going to make are going to all be within the <code>while</code> loop.</p>
<h4 id="how-should-the-robot-behave">How should the robot behave?</h4>
<p>The robot should, by default, move forwards, unless it detects an object that is too close. If an object is detected within a certain distance of the UDS, the robot should turn left or right to avoid the obstacle in front of it.</p>
<p><strong>How close is too close?</strong></p>
<p>The program currently calculates the distance of an object from the UDS in metres. You need to specify the threshold, in metres, at which an object is too close to the robot.</p>
<p>For now, the threshold value I'm going to choose is 20 cm (0.2 metres); you can experiment with this value later.</p>
<p><strong>5.</strong> Inside the <code>while</code> loop and before the <code>sleep(0.06)</code> command, use a selection statement to check if an object is less than 0.2 metres away. Instruct the robot to turn left for half a second if the distance is below the threshold value, and to move forwards otherwise.</p>
<pre><code class="python">if distance &lt; 0.2:
    robin.left()
    sleep(0.5)
else:
    robin.forward()
</code></pre>

<p>Using a sleep command here inside the <code>if</code> statement means that the robot will continue to turn left for a certain amount of time before checking for more obstructions. This should allow your robot enough time to turn clear of the object that was detected.</p>
<p><strong>6.</strong> To stop the program from running forever, add the following code inside the <code>while</code> loop before the <code>sleep(0.06)</code> command.</p>
<pre><code class="python">    if time() &gt;= end_time:
        running = False
        robin.stop()
</code></pre>

<p>This checks if the current time is more than or equal to the <code>end_time</code> value specified at the start of the program. If so, it will change the value of <code>running</code> to <code>False</code> (which will stop the <code>while</code> loop from repeating) and then stop the motors.</p>
<p><strong>7.</strong> Modify the <code>while</code> loop condition so that it stops repeating once <code>running</code> is set to <code>False</code>.</p>
<p>Change the condition from:</p>
<pre><code class="python">while True:
</code></pre>

<p>to:</p>
<pre><code class="python">while running:
</code></pre>

<p>Your final code for the <code>while</code> loop should be:</p>
<pre><code class="python">while running:
    duration = get_pulse_time()
    distance = calculate_distance(duration)

    if distance &lt; 0.2:
        robin.left()
        sleep(0.5)
    else:
        robin.forward()

    if time() &gt;= end_time:
        running = False
        robin.stop()

    sleep(0.06)
</code></pre>

<h3 id="testing-the-program">Testing the program</h3>
<p>Try running the program, with the robot on a suitable surface.</p>
<p>If the buggy is not behaving as expected, check that all the connections to the GPIO pins are correct before trying the code again.</p>
<p>It may also be beneficial to run an earlier program that you know was working, to test whether the motors and UDS are still working as expected.</p>
<h3 id="discussion">Discussion</h3>
<p>How effective is your robot at avoiding objects?</p>
<p>Can you think of any modifications that might help?</p>
<p>Share your answers in the comments below, or let us know if you are having any issues.</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
