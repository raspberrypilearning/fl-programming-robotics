<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Programming the UDS - Robotics</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Programming the UDS";
    var mkdocs_page_input_path = "week-2\\fl-progrobot-w2-step08.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Robotics</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">fl-programming-robotics</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Building a mobile robot</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step01/">Welcome to the course</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step02/">Meet the team and your fellow learners</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step03/">The world of robotics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step04/">Raspberry Pi and General-Purpose Input/Output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step05/">Connecting a motor to the motor controller</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step06/">Connecting the Raspberry Pi and battery pack to the motorboard</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step07/">Testing the motors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step08/">Designing the chassis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step09/">Attaching the components to the chassis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step10/">Making the robot move</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step11/">Challenge: Driving in patterns</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step12/">Why we call robotics challenging</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-1/fl-progrobot-w1-step13/">The end of week one</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Automating actions using distance sensors</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step01/">Welcome to week two</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step02/">Quiz: Mobile robotics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step03/">How could you improve the functionality of the buggy?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step04/">Robotic sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step05/">Autonomous robots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step06/">Ultrasonic distance sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step07/">Attaching the UDS to the buggy</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Programming the UDS</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#testing-the-uds">Testing the UDS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-the-program">Setting up the program</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#transmitting-and-receiving-the-ultrasound">Transmitting and receiving the ultrasound</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#calculating-the-distance">Calculating the distance</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#putting-the-formula-into-practice">Putting the formula into practice</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-final-program">The final program</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#testing-the-distances">Testing the distances</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step09/">Avoiding obstacles autonomously</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step10/">Challenge: Improving the obstacle-avoidance program</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step11/">Quiz: How do distance sensors work?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../fl-progrobot-w2-step12/">The end of week two</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Allowing Robots to follow lines</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step01/">Welcome to week three</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step03/">Line-sensing robots</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step04/">Line sensors and how to use them</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step05/">Connecting the line sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step06/">Testing the line sensors</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step07/">Sharing your progress</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step08/">Program a line-following algorithm</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step09/">Improving the line following</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step10/">Robotics is changing our lives</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step11/">Peer-assessment: Create a new function for your robot buggy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step12/">Reviewing your peer's work</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../week-3/fl-progrobot-w3-step14/">The end of the course</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Robotics</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Automating actions using distance sensors &raquo;</li>
        
      
    
    <li>Programming the UDS</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>[comment]: # (
Is this step open? Y/N
If so, short description of this step:
Related links:
Related files:
)</p>
<h2 id="programming-the-uds">Programming the UDS</h2>
<p>Now that you've attached the ultrasonic distance sensor (UDS), you need to test that it can detect objects that are directly in front of it at different distances.</p>
<h3 id="testing-the-uds">Testing the UDS</h3>
<p>First, you need to check that the UDS is working correctly while the robot is stationary. To interact with the UDS, you will be using the GPIO Zero library.</p>
<h4 id="setting-up-the-program">Setting up the program</h4>
<p><strong>1.</strong> In a new Python 3 file, import the libraries required for this program.</p>
<pre><code class="python">from gpiozero import InputDevice, OutputDevice
from time import sleep, time
</code></pre>

<p><code>InputDevice</code> and <code>OutputDevice</code> will be used to communicate with the trig and echo pins. You will also need <code>time</code> and <code>sleep</code> to calculate the time taken for the ultrasound to be emitted and received.</p>
<p><strong>2.</strong> Set up the trig and echo pins using the GPIO pins you connected them to on your Raspberry Pi. I used pins 4 and 17 respectively, but you may have used different pins.</p>
<pre><code class="python">trig = OutputDevice(4)
echo = InputDevice(17)

sleep(2)
</code></pre>

<p>The <code>sleep(2)</code> is there to let the sensor settle when the program starts, so that the readings are accurate.</p>
<h4 id="transmitting-and-receiving-the-ultrasound">Transmitting and receiving the ultrasound</h4>
<p><strong>3.</strong> Create a function that will be used to calculate how long it takes for the ultrasound to be transmitted and received.</p>
<p>Start by setting the trig pin to high for 10μs (microseconds), which prepares the internal clock of the UDS.</p>
<pre><code class="python">def get_pulse_time():
   trig.on()
   sleep(0.00001)
   trig.off()
</code></pre>

<p>As soon as the trig pin is set to low, a burst of ultrasound is sent from the emitter, and this sound starts to travel through the air.</p>
<p><img alt="Animation of the Trig pin being set to high for 10μs and then set to low. A burst of ultrasound is emitted from the UDS as soon as the Trig pin is set to low." src="https://howtomechatronics.com/wp-content/uploads/2015/07/Ultrasonic-Sensor-Diagram.png" /></p>
<p>Once the ultrasound has finished being emitted, the UDS sets the echo pin to high. At this point, you need to record the start time.</p>
<p><strong>4.</strong> Use a <code>while</code> loop inside the function to record the start time.</p>
<pre><code class="python">    while echo.is_active == False:
        pulse_start = time()
</code></pre>

<p>You can use the <code>is_active</code> command to check if a pin is set to high (which returns <code>True</code>) or low (which returns <code>False</code>).</p>
<p>The above code works by repeatedly replacing the value of <code>pulse_start</code> with the current time until the echo pin is active. This means that the final value of <code>pulse_start</code> is the time at which the echo pin is set to high.</p>
<p><img alt="Animation showing that once the ultrasound has finished being transmitted, the Echo pin is set to high and the start time is recorded." src="https://howtomechatronics.com/wp-content/uploads/2015/07/Ultrasonic-Sensor-Diagram.png" /></p>
<p>If the ultrasound hits an object, it is reflected back to the sensor. As soon as the receiver picks up the ultrasound, the echo pin is set to low and the program must record the end time.</p>
<p><strong>5.</strong> Inside the function, create another <code>while</code> loop that keeps replacing the end time until the echo pin is set to low.</p>
<pre><code class="python">    while echo.is_active == True:
        pulse_end = time()
</code></pre>

<p><img alt="Animation showing that if the ultrasound hits an object, it is reflected back to the sensor. As soon as the receiver picks up the ultrasound, the Echo pin is set to low and the end time is recorded. " src="https://howtomechatronics.com/wp-content/uploads/2015/07/Ultrasonic-Sensor-Diagram.png" /></p>
<p><strong>6.</strong> Finally, the function should return the amount of time it took for the pulse of ultrasound to be sent and received.</p>
<pre><code class="python">    return pulse_end - pulse_start
</code></pre>

<p>All of the code from steps 3 to 6 should be inside the function you created called <code>get_pulse_time()</code>.</p>
<p><strong>7.</strong> Test the program by running it and then typing the following into the Python shell (known as the REPL if you are using Mu).</p>
<pre><code class="python">print(get_pulse_time())
</code></pre>

<p>Try typing the above line of code when your hand is at different distances from the front of the UDS. You should get smaller values as your hand approaches the sensor.</p>
<h3 id="calculating-the-distance">Calculating the distance</h3>
<p>You can use a formula to calculate the distance the sensor is from an object, starting with the speed equation:</p>
<p><img alt="speed = distance / time" src="https://projects-static.raspberrypi.org/projects/see-like-a-bat/88c95cc4c253c700132e4c26f23373c277241549/en/images/speed.png" /></p>
<p>This can be rearranged to make:</p>
<p><img alt="distance = speed * time" src="https://projects-static.raspberrypi.org/projects/see-like-a-bat/88c95cc4c253c700132e4c26f23373c277241549/en/images/distance.png" /></p>
<p>but as the sound has to travel to the object <strong>and</strong> back, you need to divide this distance by 2:</p>
<p><img alt="distance = speed * time / 2" src="https://projects-static.raspberrypi.org/projects/see-like-a-bat/88c95cc4c253c700132e4c26f23373c277241549/en/images/distance2.png" /></p>
<p>The speed of sound in air will vary depending on the conditions, but it tends to hover at around 343 metres per second.</p>
<h4 id="putting-the-formula-into-practice">Putting the formula into practice</h4>
<p><strong>8.</strong> Create another function to calculate the distance.</p>
<pre><code class="python">def calculate_distance(duration):
    speed = 343
    distance = speed * duration / 2
    # calculate distance in metres
    return distance
</code></pre>

<p>Using a different function to calculate this distance is good coding practice, as this function can be tested separately, and can easily be reused multiple times within the program.</p>
<p><strong>9.</strong> Add an infinite loop to the bottom of the program to test that everything works.</p>
<pre><code class="python">while True:
    duration = get_pulse_time()
    distance = calculate_distance(duration)

    sleep(0.06)
    print(distance)
</code></pre>

<p>You need the <code>sleep</code> command, as the UDS requires a short wait before it can be used again.</p>
<h3 id="the-final-program">The final program</h3>
<p>Your full code should now look similar to <a href="https://rpf-futurelearn.s3-eu-west-1.amazonaws.com/Robotics+-+Robot+Buggy/code/uds-detect-objects.py">this finished program</a>.</p>
<p><strong>10</strong>. Run your code and you should see a stream of numbers showing you the distance of an object from the sensor in metres. Test this by moving a large, flat object such as a book closer to and further from the distance sensor.</p>
<h3 id="testing-the-distances">Testing the distances</h3>
<p>What range of values is your program outputting?</p>
<p>What happens if you place an object really close to, or far away from, the UDS?</p>
<p>Share your answers in the comments below.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../fl-progrobot-w2-step09/" class="btn btn-neutral float-right" title="Avoiding obstacles autonomously">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../fl-progrobot-w2-step07/" class="btn btn-neutral" title="Attaching the UDS to the buggy"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../fl-progrobot-w2-step07/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../fl-progrobot-w2-step09/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
